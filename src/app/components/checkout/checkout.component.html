<!-- src/app/components/checkout/checkout.component.html -->
<div class="checkout-container">

  <!-- Header -->
  <div class="checkout-header">
    <h1>Finalizar Compra</h1>
    <div class="step-indicator">
      <div class="step"
           *ngFor="let step of steps"
           [class.completed]="step.completed"
           [class.active]="step.active">
        <div class="step-number">{{ step.id }}</div>
        <div class="step-title">{{ step.title }}</div>
      </div>
    </div>
  </div>

  <div class="checkout-content">

    <!-- Columna principal -->
    <div class="main-column">

      <!-- Paso 1: Informaci√≥n Personal -->
      <div class="checkout-step" *ngIf="currentStep === 1">
        <h2>Informaci√≥n Personal</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="firstName">Nombre *</label>
            <input
              type="text"
              id="firstName"
              [(ngModel)]="customer.firstName"
              class="form-input"
              [class.error]="customerErrors.includes('Nombre es requerido')">
          </div>

          <div class="form-group">
            <label for="lastName">Apellido *</label>
            <input
              type="text"
              id="lastName"
              [(ngModel)]="customer.lastName"
              class="form-input"
              [class.error]="customerErrors.includes('Apellido es requerido')">
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="customer.email"
            class="form-input"
            [class.error]="customerErrors.includes('Email es requerido') || customerErrors.includes('Email inv√°lido')">
        </div>

        <div class="form-group">
          <label for="phone">Tel√©fono *</label>
          <input
            type="tel"
            id="phone"
            [(ngModel)]="customer.phone"
            class="form-input"
            [class.error]="customerErrors.includes('Tel√©fono es requerido')">
        </div>

        <!-- Errores -->
        <div class="error-messages" *ngIf="customerErrors.length > 0">
          <div class="error-message" *ngFor="let error of customerErrors">
            {{ error }}
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-primary" (click)="nextStep()">
            Continuar
          </button>
        </div>
      </div>

      <!-- Paso 2: Direcci√≥n de Env√≠o -->
      <div class="checkout-step" *ngIf="currentStep === 2">
        <h2>Direcci√≥n de Env√≠o</h2>

        <div class="form-group">
          <label for="street">Direcci√≥n *</label>
          <input
            type="text"
            id="street"
            [(ngModel)]="shippingAddress.street"
            placeholder="Calle y n√∫mero"
            class="form-input"
            [class.error]="addressErrors.includes('Direcci√≥n es requerida')">
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="city">Ciudad *</label>
            <input
              type="text"
              id="city"
              [(ngModel)]="shippingAddress.city"
              class="form-input"
              [class.error]="addressErrors.includes('Ciudad es requerida')">
          </div>

          <div class="form-group">
            <label for="state">Provincia/Estado *</label>
            <input
              type="text"
              id="state"
              [(ngModel)]="shippingAddress.state"
              class="form-input"
              [class.error]="addressErrors.includes('Provincia/Estado es requerido')">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="zipCode">C√≥digo Postal *</label>
            <input
              type="text"
              id="zipCode"
              [(ngModel)]="shippingAddress.zipCode"
              class="form-input"
              [class.error]="addressErrors.includes('C√≥digo postal es requerido')">
          </div>

          <div class="form-group">
            <label for="country">Pa√≠s *</label>
            <select
              id="country"
              [(ngModel)]="shippingAddress.country"
              (change)="onCountryChange()"
              class="form-input">
              <option *ngFor="let country of countries" [value]="country.code">
                {{ country.name }}
              </option>
            </select>
          </div>
        </div>

        <!-- Errores -->
        <div class="error-messages" *ngIf="addressErrors.length > 0">
          <div class="error-message" *ngFor="let error of addressErrors">
            {{ error }}
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary" (click)="previousStep()">
            Volver
          </button>
          <button class="btn btn-primary" (click)="nextStep()">
            Continuar
          </button>
        </div>
      </div>

      <!-- Paso 3: Revisi√≥n y Pago -->
      <div class="checkout-step" *ngIf="currentStep === 3">
        <h2>Revisi√≥n de la Orden</h2>

        <!-- Resumen de datos -->
        <div class="review-section">
          <h3>Informaci√≥n de Contacto</h3>
          <p>{{ customer.firstName }} {{ customer.lastName }}</p>
          <p>{{ customer.email }}</p>
          <p>{{ customer.phone }}</p>
          <button class="edit-btn" (click)="currentStep = 1">Editar</button>
        </div>

        <div class="review-section">
          <h3>Direcci√≥n de Env√≠o</h3>
          <p>{{ shippingAddress.street }}</p>
          <p>{{ shippingAddress.city }}, {{ shippingAddress.state }}</p>
          <p>{{ shippingAddress.zipCode }}</p>
          <p>{{ getCountryName(shippingAddress.country) }}</p>
          <button class="edit-btn" (click)="currentStep = 2">Editar</button>
        </div>

        <!-- Productos -->
        <div class="review-section">
          <h3>Productos</h3>
          <div class="order-items">
            <div class="order-item" *ngFor="let item of cartItems">
              <img [src]="item.product.image_url" [alt]="item.product.name" class="item-image">
              <div class="item-details">
                <h4>{{ item.product.name }}</h4>
                <p>Cantidad: {{ item.quantity }}</p>
                <p class="item-price">${{ (item.product.price * item.quantity).toFixed(2) }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- M√©todos de pago (simulado) -->
        <div class="review-section">
          <h3>M√©todo de Pago</h3>
          <div class="payment-method">
            <div class="payment-option">
              <input type="radio" id="credit-card" name="payment" checked>
              <label for="credit-card">üí≥ Tarjeta de Cr√©dito (Simulado)</label>
            </div>
            <p class="payment-note">
              <strong>Nota:</strong> Este es un demo. No se procesar√°n pagos reales.
            </p>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary" (click)="previousStep()">
            Volver
          </button>
          <button
            class="btn btn-success"
            (click)="completeOrder()"
            [disabled]="isProcessing">
            <span *ngIf="!isProcessing">Confirmar Orden</span>
            <span *ngIf="isProcessing">Procesando...</span>
          </button>
        </div>
      </div>

    </div>

    <!-- Sidebar con resumen -->
    <div class="sidebar">
      <div class="order-summary">
        <h3>Resumen de la Orden</h3>

        <div class="summary-items">
          <div class="summary-item" *ngFor="let item of cartItems">
            <span class="item-name">{{ item.product.name }} (x{{ item.quantity }})</span>
            <span class="item-total">${{ (item.product.price * item.quantity).toFixed(2) }}</span>
          </div>
        </div>

        <hr>

        <div class="summary-totals">
          <div class="summary-line">
            <span>Subtotal:</span>
            <span>${{ subtotal.toFixed(2) }}</span>
          </div>
          <div class="summary-line">
            <span>Env√≠o:</span>
            <span *ngIf="shipping === 0" class="free-shipping">Gratis</span>
            <span *ngIf="shipping > 0">${{ shipping.toFixed(2) }}</span>
          </div>
          <div class="summary-line">
            <span>Impuestos:</span>
            <span>${{ tax.toFixed(2) }}</span>
          </div>
          <div class="summary-line total-line">
            <span><strong>Total:</strong></span>
            <span><strong>${{ total.toFixed(2) }}</strong></span>
          </div>
        </div>

        <div class="shipping-info" *ngIf="shipping === 0">
          <p class="free-shipping-notice">
            üöö ¬°Env√≠o gratis! Tu compra supera los $100
          </p>
        </div>

      </div>

      <!-- Acciones r√°pidas -->
      <div class="quick-actions">
        <button class="btn btn-outline" (click)="goToCart()">
          ‚Üê Volver al carrito
        </button>
        <button class="btn btn-outline" (click)="goToProducts()">
          Seguir comprando
        </button>
      </div>

    </div>
  </div>
</div>
